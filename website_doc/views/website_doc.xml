<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <!-- Front-end assets: custom css -->
        <template id="assets_frontend" inherit_id="website.assets_frontend" name="documentation">
            <xpath expr="." position="inside">
                <link rel='stylesheet' href='/website_doc/static/src/css/website_doc.css'/>
            </xpath>
        </template>

        <!-- Layout add nav and footer -->
        <template id="header_footer_custom" inherit_id="website.footer_default"
            name="Footer Documentation Link">
            <xpath expr="//ul[@id='products']" position="inside">
                <li><a href="/doc/how-to">Documentation</a></li>
            </xpath>
        </template>

        <!-- Page Index -->
        <template id="toc" name="Documentation Index">
            <t t-set="level" t-value="level+1"/>
            <t t-foreach="titles" t-as="title">
                <div t-attf-class="h#{str(level) + (level&lt;3 and ' page-header' or '')}">
                    <t t-esc="title.name"/>
                </div>

                <ul t-if="title.google_doc_ids" class="mt32">
                    <li t-foreach="title.google_doc_ids" t-as="google_doc">
                        <a t-attf-href="/doc/how-to/#{slug(title)}/#{slug(google_doc)}" t-field="google_doc.name"/>
                    </li>
                </ul>

                <t t-set="titles" t-value="title.child_ids"/>
                <t t-call="website_doc.toc"/>
            </t>
        </template>

        <template id="breadcrumb" name="Documentation Breadcrumb">
            <t t-if="toc.parent_id">
                <t t-call="website_doc.breadcrumb">
                    <t t-set="toc" t-value="toc.parent_id"/>
                </t>
            </t>
            <li t-if="toc">
                <a t-attf-href="/doc/how-to/#{ slug(toc) }" t-field="toc.name"/>
            </li>
        </template>

        <template id="documentation" name="Documentation Index">
            <t t-call="website.layout">
                <section class="container mt16" t-if="toc">
                    <div class="row">
                        <ol class="breadcrumb mb0">
                            <t t-call="website_doc.breadcrumb">
                                <t t-set="toc" t-value="toc.parent_id"/>
                            </t>
                            <li class="active">
                                <span t-field="toc.name"/>
                            </li>
                        </ol>
                    </div>
                </section>
                <section class="container">
                    <t t-set="level" t-value="toc and 1 or 0"/>
                    <h1 class="page-header" t-if="toc">
                        <t t-esc="toc.name"/>
                    </h1>
                    <t t-set="titles" t-value="sections"/>
                    <t t-call="website_doc.toc"/>
                </section>
                <div class="oe_structure"/>
            </t>
        </template>

        <template id="documentation_post" name="Documentation Page">
            <t t-call="website.layout">
                <section class="container mt16" t-if="toc">
                    <div class="row">
                        <ol class="breadcrumb mb0">
                            <t t-call="website_doc.breadcrumb">
                                <t t-set="toc" t-value="toc.parent_id"/>
                            </t>
                            <li>
                                <a t-attf-href="/doc/how-to/" t-field="toc.name"/>
                            </li>
                        </ol>
                    </div>
                </section>

                <section class="container">
                    <div class="row">
                        <!-- TODO cuando agregemos soporte para pages -->
                        <!-- <t t-raw="page.arch"/> -->
                        <t t-raw="google_doc.doc_code"/>
                        <div class="row">
                            <iframe id="google-doc-iframe" srcdoc="" style="height: 1050px; margin: 0 auto; padding-left: 20px; padding-right: 20px" align="middle" frameborder="0" width="100%" height="100%" scrolling="no">
                            </iframe>

                            <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
                            <script>
                            $(function() {
                                $.get("https://docs.google.com/document/d/1veiMNSox9Isg5gbJwbYNczW57XcosSNK_0yCvyobwxk/pub?", function(html) {
                                    $("#google-doc-iframe").attr("srcdoc", html);
                                    setTimeout(function() {
                                        $("#google-doc-iframe").contents().find('a[href^="http://"]').attr("target", "_blank");
                                        $("#google-doc-iframe").contents().find('a[href^="https://"]').attr("target", "_blank");
                                    }, 1000);
                                });
                            });
                            <!-- with embedded=true -->
                            <!-- $(function() {
                                $.get("https://docs.google.com/document/d/1veiMNSox9Isg5gbJwbYNczW57XcosSNK_0yCvyobwxk/pub?embedded=true", function(html) {
                                    $("#google-doc-iframe").attr("srcdoc", html);
                                    setTimeout(function() {
                                        $("#google-doc-iframe").contents().find('a[href^="http://"]').attr("target", "_blank");
                                        $("#google-doc-iframe").contents().find('a[href^="https://"]').attr("target", "_blank");
                                    }, 1000);
                                });
                            }); -->
                            </script>            
                        </div>
                        <div t-if="len(toc.google_doc_ids)&gt;1">
                            <h2 class="page-header">Related topics</h2>
                            <ul>
                                <t t-foreach="toc.google_doc_ids" t-as="topic">
                                    <li t-if="google_doc.id != topic.id">
                                        <a t-attf-href="/doc/how-to/#{slug(toc)}/#{slug(topic)}" t-field="topic.name"/>
                                    </li>
                                </t>
                            </ul>
                        </div>
                    </div>
                </section>
                <div class="oe_structure mt16 mb16"/>
            </t>
        </template>
    </data>
</openerp>
